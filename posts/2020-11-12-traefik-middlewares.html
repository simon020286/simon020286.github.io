<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><script>!function(){try{var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem("theme");if(e){d.add(e)}else{d.add('dark');}}catch(t){}}();</script><title>Traefik - Middlewares - T-Dev</title><meta content="Creare i meddlewares base per Traefik" name="description"/><meta property="og:url" content="https://simon020286.github.io/posts/2020-11-12-traefik-middlewares"/><link rel="canonical" href="https://simon020286.github.io/posts/2020-11-12-traefik-middlewares"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Traefik - Middlewares"/><meta property="og:description" content="Creare i meddlewares base per Traefik"/><meta property="og:title" content="Traefik - Middlewares"/><meta property="og:image" content="https://nextjs-typescript-mdx-blog.vercel.appundefined"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@huntarosan"/><meta name="twitter:title" content="Traefik - Middlewares"/><meta name="twitter:description" content="Creare i meddlewares base per Traefik"/><meta name="twitter:image" content="https://nextjs-typescript-mdx-blog.vercel.appundefined"/><meta property="article:published_time" content="Thu Nov 12 2020"/><meta name="next-head-count" content="18"/><link rel="preload" href="./_next/static/css/c5987b51c198f1d093cc.css" as="style"/><link rel="stylesheet" href="./_next/static/css/c5987b51c198f1d093cc.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="./_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="./_next/static/chunks/webpack-1856074edfcdd1518f76.js" defer=""></script><script src="./_next/static/chunks/framework-895f067827ebe11ffe45.js" defer=""></script><script src="./_next/static/chunks/main-1f2c591c5d3bfcfc95e6.js" defer=""></script><script src="./_next/static/chunks/pages/_app-a14dd6af74b8559dafb5.js" defer=""></script><script src="./_next/static/chunks/838-292b52a783d0bfb7b58f.js" defer=""></script><script src="./_next/static/chunks/384-52a5c121222f81fe3d13.js" defer=""></script><script src="./_next/static/chunks/pages/posts/%5Bslug%5D-4401efa11930ab4a9e32.js" defer=""></script><script src="./_next/static/s30i1eaifIS6S8HLH4iJD/_buildManifest.js" defer=""></script><script src="./_next/static/s30i1eaifIS6S8HLH4iJD/_ssgManifest.js" defer=""></script><style id="__jsx-1084485634">html,body,body>div:first-child,div#__next,div#__next>div{height:100%;}</style></head><body class="bg-white dark:bg-black text-gray-900 dark:text-white"><div id="__next"><div class="flex flex-col min-h-screen"><header><div class="max-w-5xl px-8 mx-auto"><div class="flex items-center justify-between py-6"><nav><a class="text-gray-900 dark:text-white pr-6 py-4" href="/">Home</a><a class="text-gray-900 dark:text-white px-6 py-4" href="/tags">Tags</a></nav></div></div></header><main class="mb-0 flex-grow"><div class="max-w-5xl px-8 py-4 mx-auto"><article><h1 class="mb-3 text-gray-900 dark:text-white">Traefik - Middlewares</h1><p class="mb-10 text-sm text-gray-500 dark:text-gray-400">November 12, 2020</p><div class="prose dark:prose-dark"><p>Buongiorno a tutti,<br/>
<!-- -->oggi vedremo come creare i primi e più semplici middlewares per Traefik.<br/>
<!-- -->Cosa è un middleware?<br/>
<!-- -->Semplificando molto è qualcosa che si frappone tra la chiamata e il servizio finale o viceversa.</p><p><img src="https://doc.traefik.io/traefik/assets/img/middleware/overview.png" alt="middlwares" title="Esempio middlewares Traefik"/></p><p>Nella mia configurazione ho creato tre middlewares che trovo molto utili. Per crearli basta creare un file all&#x27;interno della cartella dynamic vista nel primo articolo dedicato a Traefik (<a href="/posts/2020-11-04-traefik-intro/">lo trovate qui</a>).<br/>
<!-- -->E&#x27; anche possibile crearli tramite label dei container, utile se è specifico per un determinato servizio.</p><ol><li><p>Redirect to https, abbastanza semplice da capire, effettua il redirect delle chiamate verso lo schema specificato. Nel mio caso tutte verso https.</p><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">http</span><span class="token punctuation">:</span>
  <span class="token key atrule">middlewares</span><span class="token punctuation">:</span>
    <span class="token key atrule">redirect-to-https</span><span class="token punctuation">:</span>
      <span class="token key atrule">redirectScheme</span><span class="token punctuation">:</span>
        <span class="token key atrule">scheme</span><span class="token punctuation">:</span> https
</code></pre></li><li><p>Basic auth, utile per redendere un po&#x27; più sicuro un endpoint aggiungendo un&#x27;autenticazione.<br/>
<!-- -->E&#x27; possibile specificare l&#x27;elenco di coppie username: password, la password deve essere criptata tramite MD5, SHA1, o BCrypt, per fare questo è possibile utilizzare su sistemi Linux <code>htpasswd</code>. E&#x27; anche possibile specificare il path di un file contenente gli utenti, sempre nello stesso formato, tramite l&#x27;attributo <code>usersFile </code>al posto di <code>users</code>.</p><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">http</span><span class="token punctuation">:</span>
  <span class="token key atrule">middlewares</span><span class="token punctuation">:</span>
    <span class="token key atrule">basic-auth</span><span class="token punctuation">:</span>
      <span class="token key atrule">basicAuth</span><span class="token punctuation">:</span>
        <span class="token key atrule">users</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token string">&#x27;&lt;username&gt;:&lt;password&gt;&#x27;</span>
</code></pre></li><li><p>Compressione della risposta, credo sia uno dei più importanti per limitare il consumo di banda. Comprime le risposte limitando appunto i dati scambiati.</p><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">http</span><span class="token punctuation">:</span>
  <span class="token key atrule">middlewares</span><span class="token punctuation">:</span>
    <span class="token key atrule">gzip-compress</span><span class="token punctuation">:</span>
      <span class="token key atrule">compress</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></li></ol><p>Per utilizzare un middleware basta specificarlo nella configurazione della route.</p><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># Se utilizzate un file come impostazione.</span>
<span class="token key atrule">http</span><span class="token punctuation">:</span>
  <span class="token key atrule">routers</span><span class="token punctuation">:</span>
    <span class="token key atrule">nome-route</span><span class="token punctuation">:</span>
      <span class="token key atrule">middlewares</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> gzip<span class="token punctuation">-</span>compress
        <span class="token punctuation">-</span> redirect<span class="token punctuation">-</span>to<span class="token punctuation">-</span>https

<span class="token comment"># Se utilizzate le labels di un container come impostazione.</span>
<span class="token key atrule">traefik.http.routers.nome-route.middlewares</span><span class="token punctuation">:</span> gzip<span class="token punctuation">-</span>compress@file<span class="token punctuation">,</span> redirect<span class="token punctuation">-</span>to<span class="token punctuation">-</span>https@file
</code></pre><p>Spero di esservi stato utile e rimango sempre a disposizione per aiutarvi.</p></div></article></div></main><footer class="py-8"><div class="max-w-5xl px-8 mx-auto">Built by T-Dev</div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"source":{"compiledSource":"var l=Object.defineProperty,u=Object.defineProperties;var N=Object.getOwnPropertyDescriptors;var p=Object.getOwnPropertySymbols;var o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;var c=(a,n,t)=\u003en in a?l(a,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[n]=t,e=(a,n)=\u003e{for(var t in n||(n={}))o.call(n,t)\u0026\u0026c(a,t,n[t]);if(p)for(var t of p(n))r.call(n,t)\u0026\u0026c(a,t,n[t]);return a},i=(a,n)=\u003eu(a,N(n));var m=(a,n)=\u003e{var t={};for(var s in a)o.call(a,s)\u0026\u0026n.indexOf(s)\u003c0\u0026\u0026(t[s]=a[s]);if(a!=null\u0026\u0026p)for(var s of p(a))n.indexOf(s)\u003c0\u0026\u0026r.call(a,s)\u0026\u0026(t[s]=a[s]);return t};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(t){var s=t,{components:a}=s,n=m(s,[\"components\"]);return mdx(MDXLayout,i(e(e({},layoutProps),n),{components:a,mdxType:\"MDXLayout\"}),mdx(\"p\",null,\"Buongiorno a tutti,\",mdx(\"br\",{parentName:\"p\"}),`\n`,\"oggi vedremo come creare i primi e pi\\xF9 semplici middlewares per Traefik.\",mdx(\"br\",{parentName:\"p\"}),`\n`,\"Cosa \\xE8 un middleware?\",mdx(\"br\",{parentName:\"p\"}),`\n`,\"Semplificando molto \\xE8 qualcosa che si frappone tra la chiamata e il servizio finale o viceversa.\"),mdx(\"p\",null,mdx(\"img\",e({parentName:\"p\"},{src:\"https://doc.traefik.io/traefik/assets/img/middleware/overview.png\",alt:\"middlwares\",title:\"Esempio middlewares Traefik\"}))),mdx(\"p\",null,\"Nella mia configurazione ho creato tre middlewares che trovo molto utili. Per crearli basta creare un file all'interno della cartella dynamic vista nel primo articolo dedicato a Traefik (\",mdx(\"a\",e({parentName:\"p\"},{href:\"/posts/2020-11-04-traefik-intro/\"}),\"lo trovate qui\"),\").\",mdx(\"br\",{parentName:\"p\"}),`\n`,\"E' anche possibile crearli tramite label dei container, utile se \\xE8 specifico per un determinato servizio.\"),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},mdx(\"p\",{parentName:\"li\"},\"Redirect to https, abbastanza semplice da capire, effettua il redirect delle chiamate verso lo schema specificato. Nel mio caso tutte verso https.\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-yaml\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-yaml\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"---\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token key atrule\"}),\"http\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"token key atrule\"}),\"middlewares\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token key atrule\"}),\"redirect-to-https\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n      `,mdx(\"span\",e({parentName:\"code\"},{className:\"token key atrule\"}),\"redirectScheme\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"token key atrule\"}),\"scheme\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),` https\n`))),mdx(\"li\",{parentName:\"ol\"},mdx(\"p\",{parentName:\"li\"},\"Basic auth, utile per redendere un po' pi\\xF9 sicuro un endpoint aggiungendo un'autenticazione.\",mdx(\"br\",{parentName:\"p\"}),`\n`,\"E' possibile specificare l'elenco di coppie username: password, la password deve essere criptata tramite MD5, SHA1, o BCrypt, per fare questo \\xE8 possibile utilizzare su sistemi Linux \",mdx(\"inlineCode\",{parentName:\"p\"},\"htpasswd\"),\". E' anche possibile specificare il path di un file contenente gli utenti, sempre nello stesso formato, tramite l'attributo \",mdx(\"inlineCode\",{parentName:\"p\"},\"usersFile \"),\"al posto di \",mdx(\"inlineCode\",{parentName:\"p\"},\"users\"),\".\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-yaml\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-yaml\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"---\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token key atrule\"}),\"http\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"token key atrule\"}),\"middlewares\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token key atrule\"}),\"basic-auth\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n      `,mdx(\"span\",e({parentName:\"code\"},{className:\"token key atrule\"}),\"basicAuth\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"token key atrule\"}),\"users\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n          `,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"-\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'\u003cusername\u003e:\u003cpassword\u003e'\"),`\n`))),mdx(\"li\",{parentName:\"ol\"},mdx(\"p\",{parentName:\"li\"},\"Compressione della risposta, credo sia uno dei pi\\xF9 importanti per limitare il consumo di banda. Comprime le risposte limitando appunto i dati scambiati.\"),mdx(\"pre\",e({parentName:\"li\"},{className:\"language-yaml\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-yaml\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"---\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token key atrule\"}),\"http\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"token key atrule\"}),\"middlewares\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token key atrule\"}),\"gzip-compress\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n      `,mdx(\"span\",e({parentName:\"code\"},{className:\"token key atrule\"}),\"compress\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`\n`)))),mdx(\"p\",null,\"Per utilizzare un middleware basta specificarlo nella configurazione della route.\"),mdx(\"pre\",e({},{className:\"language-yaml\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-yaml\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Se utilizzate un file come impostazione.\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token key atrule\"}),\"http\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"token key atrule\"}),\"routers\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"token key atrule\"}),\"nome-route\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n      `,mdx(\"span\",e({parentName:\"code\"},{className:\"token key atrule\"}),\"middlewares\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),`\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"-\"),\" gzip\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"-\"),`compress\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"-\"),\" redirect\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"-\"),\"to\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"-\"),`https\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token comment\"}),\"# Se utilizzate le labels di un container come impostazione.\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token key atrule\"}),\"traefik.http.routers.nome-route.middlewares\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\":\"),\" gzip\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"-\"),\"compress@file\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" redirect\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"-\"),\"to\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"-\"),`https@file\n`)),mdx(\"p\",null,\"Spero di esservi stato utile e rimango sempre a disposizione per aiutarvi.\"))}MDXContent.isMDXComponent=!0;\n","scope":{}},"post":{"slug":"2020-11-12-traefik-middlewares","title":"Traefik - Middlewares","date":"2020-11-12T14:44:54.748Z","description":"Creare i meddlewares base per Traefik","image":null,"tags":["self-hosted","traefik","middlewares"],"content":"\nBuongiorno a tutti,  \noggi vedremo come creare i primi e più semplici middlewares per Traefik.  \nCosa è un middleware?  \nSemplificando molto è qualcosa che si frappone tra la chiamata e il servizio finale o viceversa.\n\n![middlwares](https://doc.traefik.io/traefik/assets/img/middleware/overview.png 'Esempio middlewares Traefik')\n\nNella mia configurazione ho creato tre middlewares che trovo molto utili. Per crearli basta creare un file all'interno della cartella dynamic vista nel primo articolo dedicato a Traefik ([lo trovate qui](/posts/2020-11-04-traefik-intro/)).  \nE' anche possibile crearli tramite label dei container, utile se è specifico per un determinato servizio.\n\n1. Redirect to https, abbastanza semplice da capire, effettua il redirect delle chiamate verso lo schema specificato. Nel mio caso tutte verso https.\n\n   ```yaml\n   ---\n   http:\n     middlewares:\n       redirect-to-https:\n         redirectScheme:\n           scheme: https\n   ```\n\n2. Basic auth, utile per redendere un po' più sicuro un endpoint aggiungendo un'autenticazione.  \n   E' possibile specificare l'elenco di coppie username: password, la password deve essere criptata tramite MD5, SHA1, o BCrypt, per fare questo è possibile utilizzare su sistemi Linux `htpasswd`. E' anche possibile specificare il path di un file contenente gli utenti, sempre nello stesso formato, tramite l'attributo `usersFile `al posto di `users`.\n\n   ```yaml\n   ---\n   http:\n     middlewares:\n       basic-auth:\n         basicAuth:\n           users:\n             - '\u003cusername\u003e:\u003cpassword\u003e'\n   ```\n\n3. Compressione della risposta, credo sia uno dei più importanti per limitare il consumo di banda. Comprime le risposte limitando appunto i dati scambiati.\n\n   ```yaml\n   ---\n   http:\n     middlewares:\n       gzip-compress:\n         compress: {}\n   ```\n\nPer utilizzare un middleware basta specificarlo nella configurazione della route.\n\n```yaml\n# Se utilizzate un file come impostazione.\nhttp:\n  routers:\n    nome-route:\n      middlewares:\n        - gzip-compress\n        - redirect-to-https\n\n# Se utilizzate le labels di un container come impostazione.\ntraefik.http.routers.nome-route.middlewares: gzip-compress@file, redirect-to-https@file\n```\n\nSpero di esservi stato utile e rimango sempre a disposizione per aiutarvi.\n"},"_superjson":{"values":{"post.date":["Date"],"post.image":["undefined"]}}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"2020-11-12-traefik-middlewares"},"buildId":"s30i1eaifIS6S8HLH4iJD","assetPrefix":".","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>