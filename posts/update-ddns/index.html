<!DOCTYPE html>
<html lang="it-IT">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Update Ddns | Dev Daddy</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.74.3" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.4fc0b62e4b82c997bb0041217cd6b979.css" rel="stylesheet">
    

    

    
      

    

    
    
    <meta property="og:title" content="Update Ddns" />
<meta property="og:description" content="Eccoci qui con il primo vero post di questo blog.
Oggi ci dedicheremo all&rsquo;aggiornamento automatico dell&rsquo;ip del proprio server su alcuni servizi DDNS.
Per fare ciò esistono innumerevoli tool, ma perché utilizzare qualcosa di già fatto quando puoi imparare qualcosa di nuovo?
In questo periodo mi sto dilettando con gli script bash, quindi ho deciso di seguire questa strada. Il progetto è composto da soli due file, lo script vero e proprio e il file di configurazione, ad essere precisi ce ne sarebbe un terzo, ma viene creato automaticamente dallo script e serve solo per salvare l&rsquo;ip corrente." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://simon020286.github.io/posts/update-ddns/" />
<meta property="article:published_time" content="2020-09-17T16:59:50+02:00" />
<meta property="article:modified_time" content="2020-09-17T16:59:50+02:00" />
<meta itemprop="name" content="Update Ddns">
<meta itemprop="description" content="Eccoci qui con il primo vero post di questo blog.
Oggi ci dedicheremo all&rsquo;aggiornamento automatico dell&rsquo;ip del proprio server su alcuni servizi DDNS.
Per fare ciò esistono innumerevoli tool, ma perché utilizzare qualcosa di già fatto quando puoi imparare qualcosa di nuovo?
In questo periodo mi sto dilettando con gli script bash, quindi ho deciso di seguire questa strada. Il progetto è composto da soli due file, lo script vero e proprio e il file di configurazione, ad essere precisi ce ne sarebbe un terzo, ma viene creato automaticamente dallo script e serve solo per salvare l&rsquo;ip corrente.">
<meta itemprop="datePublished" content="2020-09-17T16:59:50+02:00" />
<meta itemprop="dateModified" content="2020-09-17T16:59:50+02:00" />
<meta itemprop="wordCount" content="783">



<meta itemprop="keywords" content="bash,ddns,self-hosted," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Update Ddns"/>
<meta name="twitter:description" content="Eccoci qui con il primo vero post di questo blog.
Oggi ci dedicheremo all&rsquo;aggiornamento automatico dell&rsquo;ip del proprio server su alcuni servizi DDNS.
Per fare ciò esistono innumerevoli tool, ma perché utilizzare qualcosa di già fatto quando puoi imparare qualcosa di nuovo?
In questo periodo mi sto dilettando con gli script bash, quindi ho deciso di seguire questa strada. Il progetto è composto da soli due file, lo script vero e proprio e il file di configurazione, ad essere precisi ce ne sarebbe un terzo, ma viene creato automaticamente dallo script e serve solo per salvare l&rsquo;ip corrente."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-navy">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Dev Daddy
      
    </a>
    <div class="flex-l items-center">
      

      
      















    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      




  <div id="sharing" class="mt3">

    
    <a href="https://www.facebook.com/sharer.php?u=https://simon020286.github.io/posts/update-ddns/" class="facebook no-underline" aria-label="share on Facebook">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

    </a>

    
    
    <a href="https://twitter.com/share?url=https://simon020286.github.io/posts/update-ddns/&amp;text=Update%20Ddns" class="twitter no-underline" aria-label="share on Twitter">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

    </a>

    
    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://simon020286.github.io/posts/update-ddns/&amp;title=Update%20Ddns" class="linkedin no-underline" aria-label="share on LinkedIn">
      <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

    </a>
  </div>


      <h1 class="f1 athelas mt3 mb1">Update Ddns</h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="2020-09-17T16:59:50+02:00">September 17, 2020</time>

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>Eccoci qui con il primo vero post di questo blog.<br>
Oggi ci dedicheremo all&rsquo;aggiornamento automatico dell&rsquo;ip del proprio server su alcuni servizi DDNS.<br>
Per fare ciò esistono innumerevoli tool, ma perché utilizzare qualcosa di già fatto quando puoi imparare qualcosa di nuovo?<br>
In questo periodo mi sto dilettando con gli script bash, quindi ho deciso di seguire questa strada. Il progetto è composto da soli due file, lo script vero e proprio e il file di configurazione, ad essere precisi ce ne sarebbe un terzo, ma viene creato automaticamente dallo script e serve solo per salvare l&rsquo;ip corrente.<br>
Come detto nel post di benvenuto, questo non vuole essere un blog di tutorial, ma la condivisione delle mie esperienze, quindi vi illustrerò come aggiornare gli ip sui due servizi che sto utilizzando al momento.</p>
<ul>
<li><a href="http://no-ip.com">No-Ip</a></li>
<li><a href="https://www.duckdns.org/">Duck DNS</a></li>
</ul>
<p>No-Ip è stato il primo servizio che ho utilizzato, offre molte opzioni e molti sotto servizi. Nella versione free è possibile registrare solo 3 hostname ed è necessario rinnovarli ogni 30 giorni.<br>
Duck DNS invece è molto più scarno, permette la registrazione di domini che terminano solo con <code>.duckdns.org</code>, ma è possibile registrare fino a 5 nomi e non richiede il rinnovo.<br>
Passiamo allo script.<br>
La parte più complicata è parsare il file di configurazione, ma per fortuna, ovviamente, esiste qualcosa di già fatto.
Ho utilizzato il metodo descritto in <a href="https://blog.sleeplessbeastie.eu/2019/11/11/how-to-parse-ini-configuration-file-using-bash/">questo articolo</a>.<br>
Non sto a spiegare come avviene il parse della configurazione perché non è oggetto di questo post e il tutto viene già spiegato nell&rsquo;articolo linkato. Proseguiamo quindi con la parte da me creata.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">GetINISections $1

DIRECTORY<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>cd <span style="color:#e6db74">`</span>dirname $0<span style="color:#e6db74">`</span> <span style="color:#f92672">&amp;&amp;</span> pwd<span style="color:#66d9ef">)</span>

filename<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$DIRECTORY<span style="color:#e6db74">/currentip.txt&#34;</span>

<span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> ! -e $filename <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
    touch $filename
<span style="color:#66d9ef">fi</span>

oldip<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>cat $filename<span style="color:#66d9ef">)</span>
currentip<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>curl -s <span style="color:#e6db74">&#39;http://ip1.dynupdate.no-ip.com/&#39;</span><span style="color:#66d9ef">)</span>

<span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span>$2<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;--force&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
  oldip<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span> 
<span style="color:#66d9ef">fi</span>
</code></pre></td></tr></table>
</div>
</div><p>La prima riga dello script va proprio a leggere il file di configurazione, che vedremo in seguito, il cui path viene passato come primo parametro allo script.<br>
Nelle righe successive viene:</p>
<ol>
<li>inizializzato il path del file in cui viene salvato l&rsquo;ultimo ip</li>
<li>letto l&rsquo;ip dal file</li>
<li>recuperato l&rsquo;ip corrente tramite l&rsquo;api messa a disposizione da no-ip e salvato nella variabile <code>currentip</code></li>
<li>se il secondo parametro passato allo script è <code>--force</code>, viene svuotato il valore dell&rsquo;ultimo ip.<br>
Vedremo in seguito il perché.</li>
</ol>
<h3 id="no-ip">No-Ip</h3>
<p>Per questo servizio è necessario utilizzare username e password utilizzati per loggarsi al sito e gli hostname che si vogliono aggiornare.
Questi se più di uno, basta separarli da virgola. E&rsquo; anche possibile utilizzare i gruppi presenti su no-ip, passando il nome del gruppo verranno aggiornati automaticamente tutti gli hostname che ne fanno parte.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#66d9ef">[NoIp]</span>
<span style="color:#a6e22e">domains</span><span style="color:#f92672">=</span><span style="color:#e6db74">&lt;NOME_DOMINIO&gt;</span>
<span style="color:#a6e22e">username</span><span style="color:#f92672">=</span><span style="color:#e6db74">&lt;USERNAME&gt;</span>
<span style="color:#a6e22e">password</span><span style="color:#f92672">=</span><span style="color:#e6db74">&lt;PASSWORD&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>Nello script bash viene semplicemente chiamata l&rsquo;api, tramite curl, messa a disposizione da no-ip, passando i dati necessari.
Il metodo effettua la chiamata solo se è presente una dominio per no-ip nel file di configurazione.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">updateNoIp<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -n <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>configuration_noip[<span style="color:#e6db74">&#34;domains&#34;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
    domains<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>configuration_noip[<span style="color:#e6db74">&#34;domains&#34;</span>]<span style="color:#e6db74">}</span>
    username<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>configuration_noip[<span style="color:#e6db74">&#34;username&#34;</span>]<span style="color:#e6db74">}</span>
    password<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>configuration_noip[<span style="color:#e6db74">&#34;password&#34;</span>]<span style="color:#e6db74">}</span>
    urlnoip<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://dynupdate.no-ip.com/nic/update?hostname=</span>$domains<span style="color:#e6db74">&amp;myip=</span>$currentip<span style="color:#e6db74">&#34;</span>
    echo <span style="color:#66d9ef">$(</span>curl -s --user $username:$password $urlnoip<span style="color:#66d9ef">)</span>
  <span style="color:#66d9ef">fi</span>
<span style="color:#f92672">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="duckdns">DuckDns</h3>
<p>Per questo servizio è sufficiente recuperare il token presente nella pagina principale una volta loggati e gli hostname che si vogliono aggiornare.
Trovate un esempio qui sotto.</p>
<p><img src="https://res.cloudinary.com/drg2utgxr/image/upload/v1600434391/posts/update-ddns/duckdns_01.png" alt="Duckdns"></p>
<p>Recuperati questi dati il file di configurazione va compilato come segue.
Se gli hostname da aggiornare sono più di uno basta scriverli separati da virgola.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#66d9ef">[DuckDns]</span>
<span style="color:#a6e22e">domains</span><span style="color:#f92672">=</span><span style="color:#e6db74">&lt;NOME_DOMINIO&gt;</span>
<span style="color:#a6e22e">token</span><span style="color:#f92672">=</span><span style="color:#e6db74">&lt;TOKEN&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>Anche in questo caso è sufficiente chiamare l&rsquo;api fornita.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">updateDuckDns<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -n <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>configuration_duckduck[<span style="color:#e6db74">&#34;domains&#34;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
    domains<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>configuration_duckduck[<span style="color:#e6db74">&#34;domains&#34;</span>]<span style="color:#e6db74">}</span>
    token<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>configuration_duckduck[<span style="color:#e6db74">&#34;token&#34;</span>]<span style="color:#e6db74">}</span>
    urlduckduck<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://www.duckdns.org/update?domains=</span>$domains<span style="color:#e6db74">&amp;token=</span>$token<span style="color:#e6db74">&amp;ip=</span>$currentip<span style="color:#e6db74">&#34;</span>
    echo <span style="color:#66d9ef">$(</span>curl -s $urlduckduck<span style="color:#66d9ef">)</span>
  <span style="color:#66d9ef">fi</span>
<span style="color:#f92672">}</span>
</code></pre></td></tr></table>
</div>
</div><p>L&rsquo;ultima parte dello script è la parte che gestisce il tutto.<br>
Se l&rsquo;ip letto dal file è diverso da quello attuale vengono chiamate le singole funzioni per i servizi e aggiornato l&rsquo;ip nel file (rig. 83), altrimenti non viene eseguita nessuna operazione.
Passando allo script come secondo parametro <code>--force</code>, come detto in precedenza, viene svuotato il valore di <code>$oldip</code> quindi l&rsquo;aggiornamento verrà fatto indipendentemente dal valore letto dal file.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span>$oldip<span style="color:#e6db74">&#34;</span> !<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span>$currentip<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
  updateNoIp
  updateDuckDns
  echo $currentip &gt; $filename
<span style="color:#66d9ef">else</span>
  echo <span style="color:#e6db74">&#39;Not changed&#39;</span>
<span style="color:#66d9ef">fi</span>
</code></pre></td></tr></table>
</div>
</div><p>Questo script lo utilizzo sul mio nas di casa su cui girano alcuni servizi accessibili da internet, per richiamarlo l&rsquo;ho schedulato ogni 30 minuti con cron.<br>
E con questo è tutto, al momento non utilizzo altri servizi per cui il mio script si ferma qui. Suppongo che funzionino più o meno allo stesso modo, quindi non dovrebbe essere complicato integrarne altri.<br>
Il codice è disponibile a questo <a href="https://github.com/simon020286/update-ddns">repository</a> di GitHub, siete liberi di proporre modifiche e aggiunte.</p>
<p>Buon divertimento</p>
<ul class="pa0">
  
   <li class="list">
     <a href="/tags/bash" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">bash</a>
   </li>
  
   <li class="list">
     <a href="/tags/ddns" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">ddns</a>
   </li>
  
   <li class="list">
     <a href="/tags/self-hosted" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">self-hosted</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-navy bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://simon020286.github.io/" >
    &copy;  Dev Daddy 2020 
  </a>
    <div>














</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
