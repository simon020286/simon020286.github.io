<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><script>!function(){try{var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem("theme");if(e){d.add(e)}else{d.add('dark');}}catch(t){}}();</script><title>T-Dev - Website - T-Dev</title><meta content="Sleep Deprived Father. Senior Web Developer." name="description"/><meta property="og:url" content="https://simon020286.github.io/tags/proxy"/><link rel="canonical" href="https://simon020286.github.io/tags/proxy"/><meta property="og:type" content="website"/><meta property="og:site_name" content="T-Dev - Website"/><meta property="og:description" content="Sleep Deprived Father. Senior Web Developer."/><meta property="og:title" content="T-Dev - Website"/><meta property="og:image" content="https://simon020286.github.io/images/site-preview.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@huntarosan"/><meta name="twitter:title" content="T-Dev - Website"/><meta name="twitter:description" content="Sleep Deprived Father. Senior Web Developer."/><meta name="twitter:image" content="https://simon020286.github.io/images/site-preview.png"/><meta name="next-head-count" content="17"/><link rel="preload" href="./_next/static/css/e2908799117bc784.css" as="style"/><link rel="stylesheet" href="./_next/static/css/e2908799117bc784.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="./_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="./_next/static/chunks/webpack-e644fd861cfeb188.js" defer=""></script><script src="./_next/static/chunks/framework-0f8b31729833af61.js" defer=""></script><script src="./_next/static/chunks/main-208998328ec77b24.js" defer=""></script><script src="./_next/static/chunks/pages/_app-aaebc3a3da0532ea.js" defer=""></script><script src="./_next/static/chunks/944-bcdef466c1c513ab.js" defer=""></script><script src="./_next/static/chunks/pages/tags/%5Btag%5D-acce6bae1b69ef2f.js" defer=""></script><script src="./_next/static/JCGWcSaViSmzqs3p2T51S/_buildManifest.js" defer=""></script><script src="./_next/static/JCGWcSaViSmzqs3p2T51S/_ssgManifest.js" defer=""></script><script src="./_next/static/JCGWcSaViSmzqs3p2T51S/_middlewareManifest.js" defer=""></script></head><body class="bg-white dark:bg-black text-gray-900 dark:text-white"><div id="__next"><div class="flex flex-col min-h-screen"><header><div class="max-w-5xl px-8 mx-auto"><div class="flex items-center justify-between py-6"><nav><a class="text-gray-900 dark:text-white pr-6 py-4" href="/">Home</a><a class="text-gray-900 dark:text-white px-6 py-4" href="/tags">Tags</a></nav></div></div></header><main class="mb-0 flex-grow"><div class="max-w-5xl px-8 py-4 mx-auto"><h1>proxy</h1><article class="mt-12"><p class="mb-1 text-sm text-gray-500 dark:text-gray-400">November 10, 2020</p><h1 class="mb-2 text-xl"><a class="text-gray-900 dark:text-white dark:hover:text-blue-400" href="/posts/2020-11-04-traefik-intro">Traefik - Intro</a></h1><div><div class="flex space-x-1"><span class="text-gray-500 dark:text-gray-400">self-hosted</span><span class="text-gray-500 dark:text-gray-400">proxy</span><span class="text-gray-500 dark:text-gray-400">traefik</span></div></div><p class="mb-3">Introduzione a traefik</p><p><a href="/posts/2020-11-04-traefik-intro">Read More</a></p></article></div></main><footer class="py-8"><div class="max-w-5xl px-8 mx-auto">Built by T-Dev</div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"posts":[{"slug":"2020-11-04-traefik-intro","title":"Traefik - Intro","date":"2020-11-10","description":"Introduzione a traefik","image":null,"tags":["self-hosted","proxy","traefik"],"content":"\nBuongiorno,  \noggi parleremo da [Traefik](https://doc.traefik.io/traefik/), un HTTP reverse proxy e load balancer.\n\n![architettura](https://doc.traefik.io/traefik/v1.7/img/architecture.png)\n\nIo lo sto utilizzando per rendere accessibili dall'esterno dei servizi hostati sul mio nas, come ad esempio Home Assistant e l'ottimo password manager Bitwarden (di cui probabilmente parlerò su questo blog).  \nSi integra perfettamente con docker, è infatti in grado di leggere automaticamente le impostazioni da un container tramite label.  \nVediamo ora come installarlo proprio tramite docker, più precisamente utilizzando docker-compose per semplificare le cose.\n\nPer prima cosa scriviamo il file di configurazione. Ci sono vari modi per configurare Traefik, via argomenti da linea di comando o via file traefik.yml, che è la strada che ho scelto io perché mi sembra più chiara. Ho commentato direttamente nel file le parti \"meno\" importanti.\n\n```yaml\n---\nglobal:\n  # Verifica la presenza di nuove versioni.\n  checkNewVersion: true\n\nentryPoints:\n  http:\n    address: :80\n    forwardedHeaders:\n      insecure: true\n    proxyProtocol:\n      insecure: true\n  https:\n    address: :443\n    forwardedHeaders:\n      insecure: true\n    proxyProtocol:\n      insecure: true\n\nproviders:\n  docker:\n    watch: true\n    exposedByDefault: false\n    endpoint: 'unix:///var/run/docker.sock'\n  file:\n    directory: '/etc/traefik/dynamic/'\n    watch: true\n\napi:\n  # Visualizza l'interfaccia web della dashboard e permetti connessioni non sicure.\n  dashboard: true\n  insecure: true\n\n# Salva il log nel percorso specificato, con livello DEBUG.\n# Ovviamente una volta impostato e verificato il corretto funzionamento si può abbassare il livello.\nlog:\n  filePath: '/shared/logs/traefik/traefik.log'\n  level: DEBUG\n\n# Salva il log delle chiamate nel percorso specificato.\n# E' possibile specificare dei filtri, nel mio caso solo le chiamate con condici di errore.\naccessLog:\n  filePath: '/shared/logs/traefik/access.log'\n  filters:\n    statusCodes: ['400-599']\n\n# Let's encrypt configuration\ncertificatesResolvers:\n  le:\n    acme:\n      email: \u003cemail\u003e\n      storage: /etc/traefik/acme/acme.json\n      tlschallenge: true\n```\n\nPer prima cosa vengono definiti gli entry points sono i punti di ingresso che può accettare il nostro proxy.  \nIo mi attendo delle connessioni dalla porta 80 e 443, è possibile aggiungere molte altre opzioni, ma per questo approfondimento vi rimando alla guida ufficiale.  \nI providers sono le risorse da cui è possibile accettare le configurazioni dinamiche, ossia i servizi, le routers e i middlewares.\n\n- docker: permette di creare delle configurazioni tramite le labels di un container.\n\n  - watch: true indica a traefik di rimanere in ascolto di modifiche sui containers, così non sarà necessario riavviare il server ad ogni modifica.\n  - exposedByDefault: false, bisogna specificare in un container se esporlo a traefik, altrimenti per ogni nuovo container in esecuzione verrà creato un servizio.\n  - endpoint: \"unix:///var/run/docker.sock\" il percorso del sock di docker per permettere la comunicazione con esso. Nel nostro caso sarà l'istanza di docker installata sul sistema host, come vedremo in seguito.\n\n- file: permette di creare le configurazioni tramite file o files yaml o toml.\n\n  - directory: \"/etc/traefik/dynamic/\" ho optato per indicare una cartella in modo da poter suddividere in modo più ordinato le impostazioni. E' possibili anche indicare un singolo file tramite l'impostazione `filename`.\n  - watch: true come sopra.\n\nL'altra parte molto importante del file è `certificatesResolvers`, cioè il modo in cui risolvere i certificati SSL.  \nNel mio caso utilizzo Let's Encrypt, un servizio gratuito che permette la generazione di certificati. Traefik integra già tutto il funzionamento basta utilizzare come provider `acme`. Le altre impostazioni sono molto semplici, una email valida per ricevere avvisi di scadenza dei certificati e il percorso dove salvare gli stessi.\n\nDefinita la configurazione base possiamo passare alla creazione del file docker-compose.yml per la creazione del container.\n\n```yaml\nversion: '3'\n\nnetworks:\n  trproxy:\n    driver: bridge\n\nservices:\n  traefik:\n    container_name: traefik\n    image: traefik:latest\n    restart: unless-stopped\n    networks:\n      - trproxy\n    environment:\n      - TZ:\"Europe/Rome\"\n    ports:\n      - 8080:8080\n      - 80:80\n      - 443:443\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock:ro\n      - \u003cdir\u003e/traefik.yml:/etc/traefik/traefik.yml:ro\n      - \u003cdir\u003e/dynamic:/etc/traefik/dynamic/:ro\n      - \u003cdir\u003e/acme/acme.json:/etc/traefik/acme/acme.json\n      - \u003cdir\u003e/shared:/shared\n```\n\nPer prima cosa viene definita la connessione, verrà utilizzata dai containers che vogliono collegarsi a traeik.  \nLe tre porte esposte sono:\n\n- 8080 dedicata alla dashboard\n- 80 per le connessioni non sicure\n- 443 per le connessioni sicure\n\nI volumi invece:\n\n- /var/run/docker.sock percorso sock docker installato sull'host\n\nScritto il file `docker-compose.yml` lanciamo il servizio con `docker-compose up -d`. In base alla connessione e potenza della macchina host ci può volere anche qualche minuto. Quando sarà tutto finito potrete raggiungere la dashboard da browser tramite http:\\\\\\\\\u003c ip della macchina su cui lo avete installato\u003e:8080.  \nSaranno già presenti un paio di servizi, tranquilli sono quelli interni che vengono creati dal proxy.\n\nCon questo la piccola guida è finita.  \nSpero di esservi stato utile.\n"}],"tag":"proxy"},"__N_SSG":true},"page":"/tags/[tag]","query":{"tag":"proxy"},"buildId":"JCGWcSaViSmzqs3p2T51S","assetPrefix":".","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>